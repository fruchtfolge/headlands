!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@turf/turf")):"function"==typeof define&&define.amd?define(["@turf/turf"],e):(t=t||self).headland=e(t.turf)}(this,(function(t){"use strict";
/**
     * splaytree v3.0.1
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */class e{constructor(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}}function n(t,e){return t>e?1:t<e?-1:0}function r(t,n,r){const i=new e(null,null);let o=i,s=i;for(;;){const e=r(t,n.key);if(e<0){if(null===n.left)break;if(r(t,n.left.key)<0){const t=n.left;if(n.left=t.right,t.right=n,null===(n=t).left)break}s.left=n,s=n,n=n.left}else{if(!(e>0))break;if(null===n.right)break;if(r(t,n.right.key)>0){const t=n.right;if(n.right=t.left,t.left=n,null===(n=t).right)break}o.right=n,o=n,n=n.right}}return o.right=n.left,s.left=n.right,n.left=i.right,n.right=i.left,n}function i(t,n,i,o){const s=new e(t,n);if(null===i)return s.left=s.right=null,s;const l=o(t,(i=r(t,i,o)).key);return l<0?(s.left=i.left,s.right=i,i.left=null):l>=0&&(s.right=i.right,s.left=i,i.right=null),s}function o(t,e,n){let i=null,o=null;if(e){const s=n((e=r(t,e,n)).key,t);0===s?(i=e.left,o=e.right):s<0?(o=e.right,e.right=null,i=e):(i=e.left,e.left=null,o=e)}return{left:i,right:o}}class s{constructor(t=n){this._root=null,this._size=0,this._comparator=t}insert(t,e){return this._size++,this._root=i(t,e,this._root,this._comparator)}add(t,n){const i=new e(t,n);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);const o=this._comparator,s=r(t,this._root,o),l=o(t,s.key);return 0===l?this._root=s:(l<0?(i.left=s.left,i.right=s,s.left=null):l>0&&(i.right=s.right,i.left=s,s.right=null),this._size++,this._root=i),this._root}remove(t){this._root=this._remove(t,this._root,this._comparator)}_remove(t,e,n){let i;if(null===e)return null;return 0===n(t,(e=r(t,e,n)).key)?(null===e.left?i=e.right:(i=r(t,e.left,n),i.right=e.right),this._size--,i):e}pop(){let t=this._root;if(t){for(;t.left;)t=t.left;return this._root=r(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null}findStatic(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}find(t){return this._root&&(this._root=r(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}contains(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}forEach(t,e){let n=this._root;const r=[];let i=!1;for(;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}range(t,e,n,r){const i=[],o=this._comparator;let s,l=this._root;for(;0!==i.length||l;)if(l)i.push(l),l=l.left;else{if(l=i.pop(),s=o(l.key,e),s>0)break;if(o(l.key,t)>=0&&n.call(r,l))return this;l=l.right}return this}keys(){const t=[];return this.forEach(({key:e})=>t.push(e)),t}values(){const t=[];return this.forEach(({data:e})=>t.push(e)),t}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}at(t){let e=this._root,n=!1,r=0;const i=[];for(;!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}next(t){let e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}prev(t){let e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}clear(){return this._root=null,this._size=0,this}toList(){return function(t){let n=t;const r=[];let i=!1;const o=new e(null,null);let s=o;for(;!i;)n?(r.push(n),n=n.left):r.length>0?(n=s=s.next=r.pop(),n=n.right):i=!0;return s.next=null,o.next}(this._root)}load(t,n=[],r=!1){let i=t.length;const o=this._comparator;if(r&&function t(e,n,r,i,o){if(r>=i)return;const s=e[r+i>>1];let l=r-1,u=i+1;for(;;){do{l++}while(o(e[l],s)<0);do{u--}while(o(e[u],s)>0);if(l>=u)break;let t=e[l];e[l]=e[u],e[u]=t,t=n[l],n[l]=n[u],n[u]=t}t(e,n,r,u,o),t(e,n,u+1,i,o)}(t,n,0,i-1,o),null===this._root)this._root=function t(n,r,i,o){const s=o-i;if(s>0){const l=i+Math.floor(s/2),u=n[l],h=r[l],a=new e(u,h);return a.left=t(n,r,i,l),a.right=t(n,r,l+1,o),a}return null}(t,n,0,i),this._size=i;else{const r=function(t,n,r){const i=new e(null,null);let o=i,s=t,l=n;for(;null!==s&&null!==l;)r(s.key,l.key)<0?(o.next=s,s=s.next):(o.next=l,l=l.next),o=o.next;null!==s?o.next=s:null!==l&&(o.next=l);return i.next}(this.toList(),function(t,n){const r=new e(null,null);let i=r;for(let r=0;r<t.length;r++)i=i.next=new e(t[r],n[r]);return i.next=null,r.next}(t,n),o);i=this._size+i,this._root=function t(e,n,r){const i=r-n;if(i>0){const o=n+Math.floor(i/2),s=t(e,n,o),l=e.head;return l.left=s,e.head=e.head.next,l.right=t(e,o+1,r),l}return null}({head:r},0,i)}return this}isEmpty(){return null===this._root}get size(){return this._size}get root(){return this._root}toString(t=(t=>String(t.key))){const e=[];return function t(e,n,r,i,o){if(e){i(`${n}${r?"└── ":"├── "}${o(e)}\n`);const s=n+(r?"    ":"│   ");e.left&&t(e.left,s,!1,i,o),e.right&&t(e.right,s,!0,i,o)}}(this._root,"",!0,t=>e.push(t),t),e.join("")}update(t,e,n){const s=this._comparator;let{left:l,right:u}=o(t,this._root,s);s(t,e)<0?u=i(e,n,u,s):l=i(e,n,l,s),this._root=function(t,e,n){return null===e?t:(null===t||((e=r(t.key,e,n)).left=t),e)}(l,u,s)}split(t){return o(t,this._root,this._comparator)}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}var a=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},f=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},g=Number.EPSILON;void 0===g&&(g=Math.pow(2,-52));var c=g*g,y=function(t,e){if(-g<t&&t<g&&-g<e&&e<g)return 0;var n=t-e;return n*n<c*t*e?0:t<e?-1:1},p=function(){function t(){l(this,t),this.reset()}return h(t,[{key:"reset",value:function(){this.xRounder=new v,this.yRounder=new v}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),v=function(){function t(){l(this,t),this.tree=new s,this.round(0)}return h(t,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===y(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===y(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),t}(),x=new p,d=function(t,e){return t.x*e.y-t.y*e.x},m=function(t,e){return t.x*e.x+t.y*e.y},b=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=d(r,i);return y(o,0)},E=function(t){return Math.sqrt(m(t,t))},S=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return m(i,r)/E(i)/E(r)},_=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},k=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},w=function(){function t(e,n){l(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return h(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:I.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),h(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&(n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,s,l,u,h=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,s=h.point,l={x:o.x-i.x,y:o.y-i.y},u={x:s.x-i.x,y:s.y-i.y},d(u,l)/E(u)/E(l)),cosine:S(e.point,t.point,h.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,s=i.cosine,l=n.get(e),u=l.sine,h=l.cosine;return o>=0&&u>=0?s<h?1:s>h?-1:0:o<0&&u<0?s<h?-1:s>h?1:0:u<o?-1:u>o?1:0}}}]),t}(),R=0,I=function(){function t(e,n,r,i){l(this,t),this.id=++R,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return h(t,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=t.leftSE.point.y,l=e.leftSE.point.y,u=t.rightSE.point.y,h=e.rightSE.point.y;if(n<r){if(l<s&&l<u)return 1;if(l>s&&l>u)return-1;var a=t.comparePoint(e.leftSE.point);if(a<0)return 1;if(a>0)return-1;var f=e.comparePoint(t.rightSE.point);return 0!==f?f:-1}if(n>r){if(s<l&&s<h)return-1;if(s>l&&s>h)return 1;var g=e.comparePoint(t.leftSE.point);if(0!==g)return g;var c=t.comparePoint(e.rightSE.point);return c<0?1:c>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(i<o){var y=e.comparePoint(t.rightSE.point);if(0!==y)return y}if(i>o){var p=t.comparePoint(e.rightSE.point);if(p<0)return 1;if(p>0)return-1}if(i!==o){var v=u-s,x=i-n,d=h-l,m=o-r;if(v>x&&d<m)return 1;if(v<x&&d>m)return-1}return i>o?1:i<o||u<h?-1:u>h?1:t.id<e.id?-1:t.id>e.id?1:0}}]),h(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var s=(t.x-e.x)/r.x,l=e.y+s*r.y;return t.y===l?0:t.y<l?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=f(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,l=t.rightSE.point,u=a(e,s)&&0===this.comparePoint(s),h=a(n,i)&&0===t.comparePoint(i),g=a(e,l)&&0===this.comparePoint(l),c=a(n,o)&&0===t.comparePoint(o);if(h&&u)return c&&!g?o:!c&&g?l:null;if(h)return g&&i.x===l.x&&i.y===l.y?null:i;if(u)return c&&o.x===s.x&&o.y===s.y?null:s;if(c&&g)return null;if(c)return o;if(g)return l;var y=function(t,e,n,r){if(0===e.x)return k(n,r,t.x);if(0===r.x)return k(t,e,n.x);if(0===e.y)return _(n,r,t.y);if(0===r.y)return _(t,e,n.y);var i=d(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},s=d(o,e)/i,l=d(o,r)/i;return{x:(t.x+l*e.x+(n.x+s*r.x))/2,y:(t.y+l*e.y+(n.y+s*r.y))/2}}(i,this.vector(),s,t.vector());return null===y?null:a(r,y)?x.round(y.x,y.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new w(e,!0),o=new w(e,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var l=new t(i,s,this.rings.slice(),this.windings.slice());return w.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),w.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var s=n;n=r,r=s}for(var l=0,u=r.rings.length;l<u;l++){var h=r.rings[l],a=r.windings[l],f=n.rings.indexOf(h);-1===f?(n.rings.push(h),n.windings.push(a)):n.windings[f]+=a}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],l=this.windings[i],u=e.indexOf(s);-1===u?(e.push(s),n.push(l)):n[u]+=l}for(var h=[],a=[],f=0,g=e.length;f<g;f++)if(0!==n[f]){var c=e[f],y=c.poly;if(-1===a.indexOf(y))if(c.isExterior)h.push(y);else{-1===a.indexOf(y)&&a.push(y);var p=h.indexOf(c.poly);-1!==p&&h.splice(p,1)}}for(var v=0,x=h.length;v<x;v++){var d=h[v].multiPoly;-1===r.indexOf(d)&&r.push(d)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(T.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===T.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var l=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=l(t)!==l(e);break;default:throw new Error("Unrecognized operation type found ".concat(T.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,s,l=w.comparePoints(e,n);if(l<0)i=e,o=n,s=1;else{if(!(l>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,s=-1}return new t(new w(i,!0),new w(o,!1),[r],[s])}}]),t}(),P=function(){function t(e,n,r){if(l(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=x.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var h=x.round(e[s][0],e[s][1]);h.x===o.x&&h.y===o.y||(this.segments.push(I.fromRing(o,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),o=h)}i.x===o.x&&i.y===o.y||this.segments.push(I.fromRing(o,i,this))}return h(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),t}(),A=function(){function t(e,n){if(l(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new P(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new P(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return h(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),N=function(){function t(e,n){if(l(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new A(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return h(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),C=function(){function t(e){l(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return h(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var s=null,l=o.leftSE,u=o.rightSE,h=[l],a=l.point,f=[];s=l,l=u,h.push(l),l.point!==a;)for(;;){var g=l.getAvailableLinkedEvents();if(0===g.length){var c=h[0].point,y=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(c.x,",")+" ".concat(c.y,"]. Last matching segment found ends at")+" [".concat(y.x,", ").concat(y.y,"]."))}if(1===g.length){u=g[0].otherSE;break}for(var p=null,v=0,x=f.length;v<x;v++)if(f[v].point===l.point){p=v;break}if(null===p){f.push({index:h.length,point:l.point});var d=l.getLeftmostComparator(s);u=g.sort(d)[0].otherSE;break}var m=f.splice(p)[0],b=h.splice(m.index);b.unshift(b[0].otherSE),n.push(new t(b.reverse()))}n.push(new t(h))}}return n}}]),h(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==b(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],l=e[1];0===b(s,t,l)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,f=[],g=h;g!=a;g+=u)f.push([e[g].x,e[g].y]);return f}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];w.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),O=function(){function t(e){l(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return h(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}(),L=function(){function t(e){l(this,t),this.rings=e,this.polys=this._composePolys(e)}return h(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new O(i));else{var o=i.enclosingRing();o.poly||e.push(new O(o)),o.poly.addInterior(i)}}return e}}]),t}(),B=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.compare;l(this,t),this.queue=e,this.tree=new s(n),this.segments=[]}return h(t,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,s=void 0,l=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===l;)null===(o=this.tree.next(o))?l=null:void 0===o.key.consumedBy&&(l=o.key);if(t.isLeft){var u=null;if(s){var h=s.getIntersection(e);if(null!==h&&(e.isAnEndpoint(h)||(u=h),!s.isAnEndpoint(h)))for(var a=this._splitSafely(s,h),f=0,g=a.length;f<g;f++)n.push(a[f])}var c=null;if(l){var y=l.getIntersection(e);if(null!==y&&(e.isAnEndpoint(y)||(c=y),!l.isAnEndpoint(y)))for(var p=this._splitSafely(l,y),v=0,x=p.length;v<x;v++)n.push(p[v])}if(null!==u||null!==c){var d=null;if(null===u)d=c;else if(null===c)d=u;else{d=w.comparePoints(u,c)<=0?u:c}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var m=e.split(d),b=0,E=m.length;b<E;b++)n.push(m[b])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&l){var S=s.getIntersection(l);if(null!==S){if(!s.isAnEndpoint(S))for(var _=this._splitSafely(s,S),k=0,R=_.length;k<R;k++)n.push(_[k]);if(!l.isAnEndpoint(S))for(var I=this._splitSafely(l,S),P=0,A=I.length;P<A;P++)n.push(I[P])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),t}(),T=new(function(){function t(){l(this,t)}return h(t,[{key:"run",value:function(t,e,n){T.type=t,x.reset();for(var r=[new N(e,!0)],i=0,o=n.length;i<o;i++)r.push(new N(n[i],!1));if(T.numMultiPolys=r.length,"difference"===T.type)for(var l=r[0],u=1;u<r.length;)null!==f(r[u].bbox,l.bbox)?u++:r.splice(u,1);if("intersection"===T.type)for(var h=0,a=r.length;h<a;h++)for(var g=r[h],c=h+1,y=r.length;c<y;c++)if(null===f(g.bbox,r[c].bbox))return[];for(var p=new s(w.compare),v=0,d=r.length;v<d;v++)for(var m=r[v].getSweepEvents(),b=0,E=m.length;b<E;b++)p.insert(m[b]);for(var S=new B(p),_=p.size,k=p.pop();k;){var R=k.key;if(p.size===_){var I=R.segment;throw new Error("Unable to pop() ".concat(R.isLeft?"left":"right"," SweepEvent ")+"[".concat(R.point.x,", ").concat(R.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}for(var P=S.process(R),A=0,O=P.length;A<O;A++){var M=P[A];void 0===M.consumedBy&&p.insert(M)}_=p.size,k=p.pop()}x.reset();var z=C.factory(S.segments);return new L(z).getGeom()}}]),t}()),M=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return T.run("union",t,n)},z=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return T.run("intersection",t,n)},D=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return T.run("difference",t,n)};function G(e,n,r){const i=e.geometry.coordinates,o=r?i[i.length-2]:i[1],s=r?i[i.length-1]:i[0],l=t.bearing(o,s),u=t.destination(s,n/1e3,l);return r?e.geometry.coordinates.push(u.geometry.coordinates):e.geometry.coordinates.unshift(u.geometry.coordinates),e}function F(t,e){let n=t-e;return n<-180?n+=360:n>180&&(n-=360),n}return{lineStrings(e,n={}){if(!e)throw new Error("No GeoJSON polygon passed to lineStrings function");n.maxAngle=n.maxAngle||30,n.minCoordDistance=n.minCoordDistance||10;let r=[],i=[],o=[],s=[],l=[],u=[],h=0,a=[],f=0;if(e=t.cleanCoords(e),n.interpolate&&(e=function(e,n){const r=[];return t.segmentEach(e,(t,e,i,o,s)=>{if(e>1||i>1||o>1)return;const l=1e3*length(t);if(0===s&&r.push(t.geometry.coordinates[0]),l>n){const e=Math.floor(l/n+1);for(var u=1;u<=e;u++){const e=along(t,u*n/1e3);r.push(e.geometry.coordinates)}}r.push(t.geometry.coordinates[1])}),polygon([r])}(e,minCoordDistance)),e.geometry.coordinates[0].forEach((e,i)=>{if(0===i||!l)return l.length&&o.push(l),l=[e],a=e,void(h=i);const g=u.length?u:a,c=1e3*t.distance(a,e);if(e[0]===g[0]&&e[1]===g[1])return;if(c<2)return;if(1===l.length)return f=t.bearing(g,e),l.push(e),a=e,void(h=i);const y=function(e,n,r,i,o){const s=1e3*t.distance(n,e),l=t.bearing(n,e),u=F(r,l);return{distance:s,angle:l,refAngle:r,angleDiff:u,exceedsTurnAngle:u>=o||u<=-o,aboveminCoordDistance:s>=i,coord:e}}(e,g,f,n.minCoordDistance,n.maxAngle);if(y.aboveminCoordDistance&&y.exceedsTurnAngle)u=[],n.debug&&r.push({...y,lastPointIndex:h,type:"Breakpoint"}),s.length?(o.push(l),l=[l[l.length-1],...s,e],f=t.bearing(s[0],e),s=[]):(o.push(l),f=t.bearing(a,e),l=[a,e]);else if(y.aboveminCoordDistance&&!y.exceedsTurnAngle)n.debug&&r.push({...y,lastPointIndex:h,type:"Regular point"}),s.length&&(l=l.concat(s),s=[]),u=[],f=y.angle,l.push(e);else if(!y.aboveminCoordDistance&&y.exceedsTurnAngle)n.debug&&r.push({...y,lastPointIndex:h,type:"Below distance, above turning angle"}),u.length||(u=g,h=i-1),s.push(e);else{const o=F(t.bearing(a,e),f),c=y.distance/n.minCoordDistance;Math.abs(o)<60&&(f+=o*c,f<-180?f+=360:f>180&&(f-=360)),n.debug&&r.push({...y,lastPointIndex:h,type:"Below distance, below turning angle"}),u.length||(u=g,h=i-1),1===s.length?(l.push(s[0]),l.push(e),s=[]):s.length?s.push(e):l.push(e)}a=e,h=i}),l.length&&o.length){const e=t.bearing(o[0][0],o[0][1]),i=F(f,e);i>=n.maxAngle||i<=-n.maxAngle?(n.debug&&r.push({angleDiff:i,refAngle:e,coord:o[0][0],lastPointIndex:h,type:"Last point"}),s.length&&(o[0]=s.concat(o[0])),o.push(l)):(n.debug&&r.push({angleDiff:i,refAngle:e,coord:o[0][0],lastPointIndex:h,type:"lastPoint"}),o[0]=l.concat(s,o[0]))}else l.length&&o.push(l);for(let n=1;n<e.geometry.coordinates.length;n++){const r=e.geometry.coordinates[n];i.push(t.polygon([r]))}const g=o.map(e=>t.lineString(e));return{lineStrings:t.featureCollection(g),holes:t.featureCollection(i),debug:r}},polygons(e,n){if(!e)throw new Error("No GeoJSON polygon passed to headlands.polygons function");n.maxAngle=n.maxAngle||30,n.minCoordDistance=n.minCoordDistance||10,n.width=n.width||12,e=t.rewind(e);const{lineStrings:r,holes:i,debug:o}=this.lineStrings(e,n);let s;try{s=r.features.map(r=>{r=G(r,n.width),r=G(r,n.width,!0);let i=t.buffer(r,n.width/1e3);if(i=function(e,n,r){let i;n=G(n,1e3*r),n=G(n,1e3*r,!0);try{i=function(e,n,r){var i,o,s,l,u,h,a,f,g,c=[],y=[],p=[],v=[],x=null;void 0===r&&(r="");if(0==t.lineIntersect(e,n).features.length)return x;var d=t.getCoords(n);if(t.booleanWithin(t.point(d[0]),e)||t.booleanWithin(t.point(d[d.length-1]),e))return x;for(v[0]=t.lineOffset(n,1e-4,{units:"kilometers"}),v[1]=t.lineOffset(n,-1e-4,{units:"kilometers"}),v[0].geometry.coordinates=v[0].geometry.coordinates.filter(t=>!isNaN(t[0])),v[1].geometry.coordinates=v[1].geometry.coordinates.filter(t=>!isNaN(t[0])),i=0;i<=1;i++){for(l=i,u=(i+1)%2,c=[],o=0;o<n.geometry.coordinates.length;o++)c.push(n.geometry.coordinates[o]);for(o=v[l].geometry.coordinates.length-1;o>=0;o--)c.push(v[l].geometry.coordinates[o]);for(c.push(n.geometry.coordinates[0]),c=c.filter(t=>!isNaN(t[0])),h=t.lineString(c),a=t.lineToPolygon(h),f=t.difference(e,a),y=[],o=0;o<f.geometry.coordinates.length;o++)g=t.polygon(f.geometry.coordinates[o]),t.lineIntersect(g,v[u]).features.length>0&&y.push(g.geometry.coordinates);y.forEach((function(e,n){s=r+(i+1)+"."+(n+1),p.push(t.polygon(e,{id:s}))}))}p.length>0&&(x=t.featureCollection(p));return x}(e,n),i=i.features[0]}catch(t){i=e}return i}(i,r,n.width),i=function(e,n,r){const i=z(e.geometry.coordinates,n.geometry.coordinates);if(!i)return e;const o=t.buffer(n,r/1e3*-1);return e=D(i,o.geometry.coordinates),t.multiPolygon(e)}(i,e,n.width),i)return i})}catch(t){throw new Error("Failed to create headland polygons. This is likely to occur when the input polygon is too small: "+t)}return i&&i.features&&i.features.length&&i.features.forEach(e=>{let r=t.buffer(e,n.width/1e3);r=t.difference(r,e),s.push(r)}),s=function(e){const n=[];for(let r=0;r<e.length;r++){if(!e[r])continue;const i=e[r];try{const r=e.filter(t=>t!==i),o=M(...r.map(t=>t.geometry.coordinates)),s=z(i.geometry.coordinates,o);if(!s)continue;const l=t.multiPolygon(s),u=t.area(l),h=t.area(i);if(u>.99*h)continue;i.properties.area=h,n.push(i)}catch(t){console.log(t),n.push(i)}}return n}(s),{polygons:t.featureCollection(s),debug:o}}}}));
